{% extends "layouts/base.html" %}

{% block title %}Peta Wisata - Lelana.id{% endblock %}

{% block content %}
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12">
        <!-- Header Halaman -->
        <div class="text-center mb-8 sm:mb-10">
            <h1 class="text-3xl sm:text-4xl lg:text-5xl font-extrabold text-gray-900 dark:text-white tracking-tight">Peta Wisata Interaktif</h1>
            <p class="mt-4 max-w-2xl mx-auto text-base sm:text-lg text-gray-600 dark:text-gray-400">
                Temukan lokasi-lokasi wisata menarik di Banyumas dan sekitarnya.
            </p>
        </div>

        <!-- Container Peta -->
        <div class="relative z-10 w-full h-[60vh] md:h-[70vh] rounded-2xl shadow-[0_1px_3px_rgba(0,0,0,0.1)] border border-gray-200 dark:border-gray-700 overflow-hidden">
            <div id="map" class="w-full h-full"></div>
        </div>
    </div>
{% endblock %}

{% block scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const map = L.map('map').setView([-7.4313, 109.2443], 11);

            // Selalu gunakan layer peta yang terang
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                maxZoom: 19,
                attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            fetch('{{ url_for("wisata.api_lokasi_wisata") }}').then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            }).then(data => {
                data.forEach(lokasi => {
                    if (lokasi.lat && lokasi.lon) {
                        const marker = L.marker([lokasi.lat, lokasi.lon]).addTo(map);
                        const popupContent = `
                            <div class="p-1">
                                <h3 class="font-bold text-lg mb-1 text-gray-800 dark:text-gray-100">${lokasi.nama}</h3>
                                <a href="${lokasi.detail_url}" target="_blank" class="inline-flex items-center text-primary-600 dark:text-primary-400 hover:text-primary-500 dark:hover:text-primary-300 font-semibold text-sm transition-colors">
                                    Lihat Detail
                                    <svg class="w-4 h-4 ml-1" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-4.5 0V6M18 6h-6m6 0l-7.5 7.5" />
                                    </svg>
                                </a>
                            </div>
                        `;
                        marker.bindPopup(popupContent);
                    }
                });
            }).catch(error => {
                console.error('Error fetching location data:', error);
                const errorDiv = L.DomUtil.create('div', 'leaflet-bar leaflet-control');
                errorDiv.innerHTML = 'Gagal memuat data lokasi';
                errorDiv.style.backgroundColor = 'white';
                errorDiv.style.color = 'red';
                errorDiv.style.padding = '5px 10px';
                errorDiv.style.borderRadius = '5px';
                const control = new L.Control({ position: 'topright' });
                control.onAdd = function() { return errorDiv; };
                control.addTo(map);
            });
        });
    </script>
    <style>
        .leaflet-popup-content-wrapper,
        .leaflet-popup-tip {
            background: var(--bg-color, #fff);
            color: var(--text-color, #111827);
            border-radius: 8px;
            box-shadow: 0 3px 14px rgba(0,0,0,0.4);
        }
        .leaflet-popup-content {
            margin: 12px !important;
        }
        html.dark .leaflet-popup-content-wrapper, html.dark .leaflet-popup-tip {
            background: var(--bg-color, #1f2937);
            color: var(--text-color, #f9fafb);
        }
    </style>
{% endblock %}